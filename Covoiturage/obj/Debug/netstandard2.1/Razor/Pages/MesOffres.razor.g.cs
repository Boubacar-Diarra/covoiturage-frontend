#pragma checksum "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "561b3ef5254eb1ff6a83776ec3a5989bc9181348"
// <auto-generated/>
#pragma warning disable 1591
namespace Covoiturage.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\_Imports.razor"
using System.Net.Http.Json;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\_Imports.razor"
using Microsoft.AspNetCore.Components.WebAssembly.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\_Imports.razor"
using Covoiturage;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\_Imports.razor"
using Covoiturage.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"
using Covoiturage.Payloads.Request;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/fetchmesoffres")]
    public partial class MesOffres : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
            __builder.OpenElement(0, "div");
            __builder.AddAttribute(1, "class", "row");
            __builder.AddAttribute(2, "style", "display: flex; flex-wrap: wrap; justify-content: space-between;");
            __builder.OpenElement(3, "div");
            __builder.AddAttribute(4, "class", "col");
            __builder.AddAttribute(5, "style", "display: flex; flex-wrap: wrap; justify-content: space-around;");
#nullable restore
#line 8 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"
         if (_offres != null)
        {
            

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"
             foreach (var o in _offres)
            {

#line default
#line hidden
#nullable disable
            __builder.OpenElement(6, "div");
            __builder.AddAttribute(7, "class", "card text-capitalize");
            __builder.AddAttribute(8, "style", "width: 48%; margin-bottom: 20px");
            __builder.OpenElement(9, "div");
            __builder.AddAttribute(10, "class", "card-body");
            __builder.OpenElement(11, "div");
            __builder.AddAttribute(12, "class", "row");
            __builder.AddMarkupContent(13, "<div class=\"col-3\"><svg id=\"efaf6d37-ad8b-408b-a167-fb47e2b6544c\" data-name=\"Layer 1\" xmlns=\"http://www.w3.org/2000/svg\" width=\"8em\" height=\"8em\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 1142.04574 959.78855\"><defs><linearGradient id=\"eaeac4a1-6091-43b3-af38-ae8114f9a62f\" x1=\"535.45073\" y1=\"779.24414\" x2=\"535.45073\" y2=\"104.90687\" gradientUnits=\"userSpaceOnUse\"><stop offset=\"0\" stop-color=\"gray\" stop-opacity=\"0.25\"></stop><stop offset=\"0.53514\" stop-color=\"gray\" stop-opacity=\"0.12\"></stop><stop offset=\"1\" stop-color=\"gray\" stop-opacity=\"0.1\"></stop></linearGradient><clipPath id=\"b609a8ad-8ad7-4296-9cf1-6f9923717ce3\" transform=\"translate(-64.54927 -7.92449)\"><polygon points=\"889.286 734.556 724.703 734.556 473.645 758.825 220.644 734.556 220.644 139.96 472.596 158.162 729.989 139.96 981.786 174.341 981.786 641.525 889.286 734.556\" fill=\"#6c63ff\"></polygon></clipPath><linearGradient id=\"eaa4df2b-8460-421b-8c86-0d729e8c7ac3\" x1=\"873.18636\" y1=\"742.81095\" x2=\"873.18636\" y2=\"620.07624\" gradientUnits=\"userSpaceOnUse\"><stop offset=\"0\" stop-opacity=\"0.12\"></stop><stop offset=\"0.55135\" stop-opacity=\"0.09\"></stop><stop offset=\"1\" stop-opacity=\"0.02\"></stop></linearGradient></defs><title>Map dark</title><polygon points=\"829.064 752.8 669.299 752.8 397.178 779.244 122.951 752.8 122.951 104.907 396.041 124.74 675.029 104.907 947.951 142.37 940.945 639.909 829.064 752.8\" fill=\"url(#eaeac4a1-6091-43b3-af38-ae8114f9a62f)\"></polygon><polygon points=\"823.856 743.794 667.586 743.794 401.418 769.524 133.19 743.794 133.19 113.412 400.306 132.709 673.19 113.412 940.142 149.863 933.289 633.955 823.856 743.794\" fill=\"#fff\"></polygon><polygon points=\"824.736 726.631 660.154 726.631 409.096 750.901 156.095 726.631 156.095 132.035 408.047 150.237 665.44 132.035 917.237 166.417 917.237 633.6 824.736 726.631\" fill=\"#6c63ff\"></polygon><g clip-path=\"url(#b609a8ad-8ad7-4296-9cf1-6f9923717ce3)\"><polygon points=\"1142.046 905.143 564.089 585.083 710.891 97.332 660.931 77.52 589.788 313.893 22.967 0 0 54.646 572.409 371.634 441.726 805.828 491.686 825.64 546.71 642.823 1119.079 959.789 1142.046 905.143\" fill=\"#fff\"></polygon></g><polygon points=\"813.083 742.811 815.019 620.076 933.289 624.847 813.083 742.811\" fill=\"url(#eaa4df2b-8460-421b-8c86-0d729e8c7ac3)\"></polygon><polygon points=\"156.095 388.993 518.844 549.605 542.951 599.576 518.951 624.576 156.095 452.489 156.095 388.993\" fill=\"#fff\"></polygon><polygon points=\"823.856 742.811 825.618 629.555 933.289 633.957 823.856 742.811\" fill=\"#fff\"></polygon><polygon points=\"648.951 647.576 800.309 150.451 860.519 158.672 690.951 673.576 648.951 647.576\" fill=\"#fff\"></polygon><polyline points=\"408.047 750.901 659.999 726.631 659.999 132.035 408.047 150.237\" opacity=\"0.1\"></polyline><path d=\"M703.348,356.36044c0,48.0293-86.96475,184.04167-86.96475,184.04167s-86.96474-136.01237-86.96474-184.04167a86.96475,86.96475,0,1,1,173.92949,0Z\" transform=\"translate(-64.54927 -7.92449)\" fill=\"#ff5252\"></path><circle cx=\"551.83402\" cy=\"342.36863\" r=\"26.29167\" fill=\"#fff\"></circle><polygon points=\"784.67 388.993 917.237 423.009 917.237 486.505 754.951 428.576 784.67 388.993\" fill=\"#fff\"></polygon><polygon points=\"279.434 510.983 245.951 742.576 283.951 750.576 334.01 536.866 333.951 506.576 279.434 510.983\" fill=\"#fff\"></polygon><polygon points=\"278.084 208.643 240.514 426.371 269.604 442.076 338.951 208.576 278.084 208.643\" fill=\"#fff\"></polygon><circle cx=\"349.95073\" cy=\"165.57551\" r=\"8\" fill=\"#ff5252\"></circle><circle cx=\"253.95073\" cy=\"579.57551\" r=\"8\" fill=\"#ff5252\"></circle><circle cx=\"245.95073\" cy=\"638.57551\" r=\"8\" fill=\"#ff5252\"></circle><circle cx=\"330.95073\" cy=\"624.57551\" r=\"8\" fill=\"#ff5252\"></circle><circle cx=\"193.95073\" cy=\"384.57551\" r=\"8\" fill=\"#ff5252\"></circle><circle cx=\"823.95073\" cy=\"376.57551\" r=\"8\" fill=\"#ff5252\"></circle><circle cx=\"754.95073\" cy=\"654.57551\" r=\"8\" fill=\"#ff5252\"></circle></svg></div>\r\n                            ");
            __builder.OpenElement(14, "div");
            __builder.AddAttribute(15, "class", "col");
            __builder.OpenElement(16, "div");
            __builder.AddAttribute(17, "style", "padding-left: 30px");
            __builder.AddMarkupContent(18, "\r\n                                    Prix: ");
            __builder.AddContent(19, 
#nullable restore
#line 20 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"
                                           o.prix

#line default
#line hidden
#nullable disable
            );
            __builder.AddMarkupContent(20, " <br>\r\n                                    Nombre de place: ");
            __builder.AddContent(21, 
#nullable restore
#line 21 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"
                                                      o.nbrePlace

#line default
#line hidden
#nullable disable
            );
            __builder.AddMarkupContent(22, " <br>\r\n                                    Est conducteur: ");
            __builder.AddContent(23, 
#nullable restore
#line 22 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"
                                                     o.estConducteur

#line default
#line hidden
#nullable disable
            );
            __builder.AddMarkupContent(24, " <br>\r\n                                    Lieu de depart: ");
            __builder.AddContent(25, 
#nullable restore
#line 23 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"
                                                     o.lieuDepart

#line default
#line hidden
#nullable disable
            );
            __builder.AddMarkupContent(26, " <br>\r\n                                    Lieu d\'arrivée: ");
            __builder.AddContent(27, 
#nullable restore
#line 24 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"
                                                     o.lieuArrivee

#line default
#line hidden
#nullable disable
            );
            __builder.AddMarkupContent(28, " <br>\r\n                                    Date de depart: ");
            __builder.AddContent(29, 
#nullable restore
#line 25 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"
                                                     o.dateDepart

#line default
#line hidden
#nullable disable
            );
            __builder.AddMarkupContent(30, " <br>\r\n                                    Conduite alternée: ");
            __builder.AddContent(31, 
#nullable restore
#line 26 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"
                                                        o.alternance

#line default
#line hidden
#nullable disable
            );
            __builder.AddMarkupContent(32, " <br>\r\n                                    Escales:\r\n");
#nullable restore
#line 28 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"
                                     foreach (var i in o.escales)
                                    {

#line default
#line hidden
#nullable disable
            __builder.AddContent(33, "Lieu ");
            __builder.AddContent(34, 
#nullable restore
#line 30 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"
                                                i.lieu

#line default
#line hidden
#nullable disable
            );
            __builder.AddMarkupContent(35, "\r\n                                        Motif: ");
            __builder.AddContent(36, 
#nullable restore
#line 31 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"
                                                  i.motif

#line default
#line hidden
#nullable disable
            );
#nullable restore
#line 32 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"
                                    }

#line default
#line hidden
#nullable disable
            __builder.AddMarkupContent(37, "<br>\r\n                                    Voiture: ");
            __builder.AddContent(38, 
#nullable restore
#line 34 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"
                                              o.voiture.marque

#line default
#line hidden
#nullable disable
            );
            __builder.AddContent(39, " ");
            __builder.AddContent(40, 
#nullable restore
#line 34 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"
                                                                o.voiture.type

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.AddMarkupContent(41, "\r\n                        <hr>\r\n                        ");
            __builder.OpenElement(42, "table");
            __builder.AddAttribute(43, "class", "table table-striped table-borderless");
            __builder.AddMarkupContent(44, "<thead><tr><th>Nom</th>\r\n                                    <th>Téléphone</th>\r\n                                    <th>Email</th>\r\n                                    <th>Description</th>\r\n                                    <th>Action</th></tr></thead>");
#nullable restore
#line 49 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"
                             foreach (var user in _od[o])
                            {


#line default
#line hidden
#nullable disable
            __builder.OpenElement(45, "tbody");
            __builder.OpenElement(46, "tr");
            __builder.OpenElement(47, "td");
            __builder.AddContent(48, 
#nullable restore
#line 54 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"
                                             user.nom

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(49, "\r\n                                        ");
            __builder.OpenElement(50, "td");
            __builder.AddContent(51, 
#nullable restore
#line 55 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"
                                             user.telephone

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(52, "\r\n                                        ");
            __builder.OpenElement(53, "td");
            __builder.AddContent(54, 
#nullable restore
#line 56 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"
                                             user.email

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(55, "\r\n                                        ");
            __builder.OpenElement(56, "td");
            __builder.AddContent(57, 
#nullable restore
#line 57 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"
                                             user.description

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(58, "\r\n                                        ");
            __builder.OpenElement(59, "td");
            __builder.OpenElement(60, "button");
            __builder.AddAttribute(61, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 59 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"
                                                              () => Accepter(user.id, o.id)

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(62, "type", "button");
            __builder.AddAttribute(63, "class", "btn btn-primary");
            __builder.AddMarkupContent(64, @"<svg xmlns=""http://www.w3.org/2000/svg"" width=""16"" height=""16"" fill=""currentColor"" class=""bi bi-check2"" viewBox=""0 0 16 16""><path d=""M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z""></path></svg>");
            __builder.CloseElement();
            __builder.AddMarkupContent(65, "\r\n                                            ");
            __builder.OpenElement(66, "button");
            __builder.AddAttribute(67, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 64 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"
                                                              () => Refuser(user.id, o.id)

#line default
#line hidden
#nullable disable
            ));
            __builder.AddAttribute(68, "type", "button");
            __builder.AddAttribute(69, "class", "btn btn-danger");
            __builder.AddMarkupContent(70, @"<svg xmlns=""http://www.w3.org/2000/svg"" width=""16"" height=""16"" fill=""currentColor"" class=""bi bi-x"" viewBox=""0 0 16 16""><path d=""M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z""></path></svg>");
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.CloseElement();
#nullable restore
#line 72 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"

                            }

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.CloseElement();
            __builder.AddMarkupContent(71, "\r\n                <br>");
#nullable restore
#line 78 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"
            }

#line default
#line hidden
#nullable disable
#nullable restore
#line 78 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"
             
        }
        else
        {

#line default
#line hidden
#nullable disable
            __builder.OpenComponent<Covoiturage.Pages.Loading>(72);
            __builder.CloseComponent();
#nullable restore
#line 83 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"
        }

#line default
#line hidden
#nullable disable
            __builder.CloseElement();
            __builder.CloseElement();
        }
        #pragma warning restore 1998
#nullable restore
#line 87 "C:\Users\diarr\source\repos\Covoiturage\Covoiturage\Pages\MesOffres.razor"
       
    private List<OffreRequest> _offres;
    private Dictionary<OffreRequest, List<RegisterRequest>> _od = new Dictionary<OffreRequest, List<RegisterRequest>>();

    protected override async Task OnInitializedAsync()
    {
        var token = await Js.InvokeAsync<string>("getItemLs", new object[] { "token" });
        if (!string.IsNullOrEmpty(token))
        {
            var id = await Js.InvokeAsync<string>("getItemLs", "id");
            var response = await HttpClient.GetAsync("http://localhost:8080/api/offre/mesoffres/"+id);
            if (response.IsSuccessStatusCode)
            {
                _offres = await response.Content.ReadFromJsonAsync<List<OffreRequest>>();
                if (_offres == null || _offres.Count == 0)
                {
                    await Js.InvokeVoidAsync("showToast", "succes", "Aucune offre n'a été trouvée");
                }
                else
                {
                    /*var res = await HttpClient.GetAsync("http://localhost:8080/api/demande/demandes/1");
                    if (res.IsSuccessStatusCode)
                    {
                        var registerRequests = await res.Content.ReadFromJsonAsync<List<DemandeRequest>>();
                        Console.WriteLine(registerRequests);
                    }*/
                    
                    foreach (var offre in _offres)
                    {
                        var res = await HttpClient.GetAsync("http://localhost:8080/api/demande/demandeurs/"+offre.id);
                        if (!res.IsSuccessStatusCode) continue;
                        var registerRequests = await res.Content.ReadFromJsonAsync<List<RegisterRequest>>();
                        //Console.WriteLine(registerRequests);
                        _od.Add(offre, registerRequests);
                    }
                }
            }
            else
            {
                await Js.InvokeVoidAsync("showToast", "error", "Une erreur est survenue");
            }
        }
    }
    
    private async void Accepter(long idUser, long idOffre)
    {
        var res = await HttpClient.PutAsJsonAsync("http://localhost:8080/api/demande/accepter/"+idUser+"/"+idOffre, new { userId = ""});
        if (res.IsSuccessStatusCode)
        {
            //var registerRequests = await res.Content.ReadFromJsonAsync<List<RegisterRequest>>();
            await Js.InvokeVoidAsync("showToast", "succes", "Opération effectuée avec succès");
        }
        else
        {
            await Js.InvokeVoidAsync("showToast", "error", "Opération échouée");
        }   
    }
    private async void Refuser(long idUser, long idOffre)
    {
        var res = await HttpClient.PutAsJsonAsync("http://localhost:8080/api/demande/refuser/"+idUser+"/"+idOffre, new { userId = ""});
        if (res.IsSuccessStatusCode)
        {
    //var registerRequests = await res.Content.ReadFromJsonAsync<List<RegisterRequest>>();
            await Js.InvokeVoidAsync("showToast", "succes", "Opération effectuée avec succès");
        }
        else
        {
            await Js.InvokeVoidAsync("showToast", "error", "Opération échouée");
        }   
    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private IJSRuntime Js { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private HttpClient HttpClient { get; set; }
    }
}
#pragma warning restore 1591
